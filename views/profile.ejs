<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profile | Re-Give</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    rel="shortcut icon"
    href="https://storage.googleapis.com/workspace-0f70711f-8b4e-4d94-86f1-2a93ccde5887/image/0e7d49ef-31f4-4759-82b9-b486dc7aa23f.png"
    type="image/x-icon"
  />
</head>

<body class="bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 min-h-screen text-gray-100 flex flex-col">

  <!-- ✅ Popup -->
  <div id="popup" style="
    display:none;
    position:fixed;
    top:20px;
    right:20px;
    background:#22c55e;
    color:white;
    padding:12px 20px;
    border-radius:10px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    font-size:15px;
    font-weight:600;
    z-index:9999;
    transition:opacity 0.3s ease;">
  </div>

  <!-- Navbar -->
  <header class="bg-gray-800/60 backdrop-blur-md border-b border-gray-700 p-4 flex justify-between items-center shadow-lg">
    <h1 class="text-2xl font-bold text-green-400 tracking-wide">My Profile</h1>
    <nav class="flex gap-4">
      <a href="/dashboard" class="bg-green-500 hover:bg-green-600 text-black font-semibold px-4 py-2 rounded-lg transition">
        Dashboard
      </a>
      <a href="/logout" class="bg-red-600 hover:bg-red-700 text-white font-semibold px-4 py-2 rounded-lg transition">
        Logout
      </a>
    </nav>
  </header>

  <!-- Profile Section -->
  <main class="flex-grow flex items-center justify-center p-6">
    <div class="bg-gray-900/70 backdrop-blur-lg border border-gray-700 rounded-2xl shadow-2xl w-full max-w-2xl p-10 transition hover:border-green-400">

      <!-- Profile Avatar -->
      <div class="flex flex-col items-center text-center mb-8">
        <div class="w-28 h-28 rounded-full bg-green-500/10 border border-green-400 flex items-center justify-center text-5xl text-green-400 font-bold shadow-md">
          <%= user.email?.charAt(0).toUpperCase() %>
        </div>
        <h2 class="text-2xl font-semibold mt-4"><%= user.name || "Your Name" %></h2>
        <p class="text-gray-400"><%= user.email %></p>
      </div>

      <!-- View Mode -->
      <div id="viewMode" class="space-y-4">
        <div class="flex justify-between border-b border-gray-700 pb-2">
          <span class="text-gray-400">Full Name</span>
          <span class="text-white font-medium"><%= user.name || "Not Provided" %></span>
        </div>

        <div class="flex justify-between border-b border-gray-700 pb-2">
          <span class="text-gray-400">Email</span>
          <span class="text-white font-medium"><%= user.email %></span>
        </div>

        <div class="flex justify-between border-b border-gray-700 pb-2">
          <span class="text-gray-400">Contact Number</span>
          <span class="text-white font-medium"><%= user.contact || "Not Provided" %></span>
        </div>

        <div class="flex justify-end pt-4">
          <button
            id="editBtn"
            class="bg-green-500 hover:bg-green-600 text-black font-semibold py-2 px-6 rounded-lg shadow-lg transition">
            Edit Profile
          </button>
        </div>
      </div>

      <!-- Edit Mode -->
      <form id="editForm" action="/profile" method="POST" class="hidden space-y-6 animate-fadeIn">
        <div>
          <label class="block text-gray-400 text-sm mb-1">Full Name</label>
          <input
            type="text"
            name="name"
            value="<%= user.name || '' %>"
            placeholder="Enter your full name"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-green-400 focus:outline-none"
          />
        </div>

        <div>
          <label class="block text-gray-400 text-sm mb-1">Contact Number</label>
          <input
            type="text"
            name="contact"
            value="<%= user.contact || '' %>"
            placeholder="Enter your contact number"
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-green-400 focus:outline-none"
          />
        </div>

        <div>
          <label class="block text-gray-400 text-sm mb-1">Email (Read-only)</label>
          <input
            type="text"
            value="<%= user.email %>"
            disabled
            class="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-gray-500 cursor-not-allowed"
          />
        </div>

        <div class="flex justify-between items-center">
          <button
            type="button"
            id="cancelBtn"
            class="text-gray-400 hover:text-red-400 transition">
            Cancel
          </button>

          <button
            type="submit"
            class="bg-green-500 hover:bg-green-600 text-black font-semibold py-2 px-6 rounded-lg shadow-lg transition">
            Save Changes
          </button>
        </div>
      </form>
    </div>
  </main>

  <!-- JS Logic -->
  <script>
    const editBtn = document.getElementById("editBtn");
    const cancelBtn = document.getElementById("cancelBtn");
    const viewMode = document.getElementById("viewMode");
    const editForm = document.getElementById("editForm");

    editBtn.addEventListener("click", () => {
      viewMode.classList.add("hidden");
      editForm.classList.remove("hidden");
    });

    cancelBtn.addEventListener("click", () => {
      editForm.classList.add("hidden");
      viewMode.classList.remove("hidden");
    });

    // ✅ Popup for success/failure
    const params = new URLSearchParams(window.location.search);
    const updated = params.get("updated");
    const popup = document.getElementById("popup");
    if (updated) {
      popup.textContent = updated === "true"
        ? "✅ Profile updated successfully!"
        : "❌ Failed to update profile!";
      popup.style.background = updated === "true" ? "#22c55e" : "#ef4444";
      popup.style.display = "block";
      popup.style.opacity = "1";
      setTimeout(() => {
        popup.style.opacity = "0";
        setTimeout(() => (popup.style.display = "none"), 300);
      }, 3000);
    }
  </script>

  <style>
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeIn {
      animation: fadeIn 0.4s ease;
    }
  </style>

</body>
</html>
